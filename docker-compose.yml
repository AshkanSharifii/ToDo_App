version: '3'

services:
  consul:
    image: hashicorp/consul:1.15.3
    ports:
      - "8500:8500"
    command: "agent -server -ui -node=server-1 -bootstrap-expect=1 -client=0.0.0.0"
    networks:
      - app-network

  todoapp:
    build: ./ToDoApp
    ports:
      - "8080:8080"
    env_file:
      - ./.env
    depends_on:
      - consul
    networks:
      - app-network

  notification-service:
    build: ./NotificationService
    ports:
      - "8081:8081"
    environment:
      - CONSUL_HOST=consul
      - CONSUL_PORT=8500
    depends_on:
      - consul
    networks:
      - app-network

networks:
  app-network:
    driver: bridge